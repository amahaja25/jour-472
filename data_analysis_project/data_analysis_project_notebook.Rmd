---
title: "Data Analysis Project"
output: html_notebook
---

```{r}

# Load libraries!
library(tidyverse)
library(janitor)
library(tidycensus)


options(scipen=999)

```

Load and clean data

```{r}

md_payments <- read_csv("data/State_of_Maryland_Payments_Data__FY2008_to_FY2024.csv") |> clean_names()

view(md_payments)

# The data frame has 430584 rows and 8 columns

# One limitation is that it might be difficult to define each industry just based on agency, and we do not know what each code in the category column means or stands for. In terms of timeframe, we do not have limitations as our data spans from 2008 to 2024.


```

How does the distribution of spending change from year to year?

```{r}

md_payments_by_year <- md_payments |>
  group_by(fiscal_year) |>
  summarise(total = sum(amount)) |>
  arrange(desc(total)) 

md_payments |>
  filter(fiscal_year == 2024) |>
  arrange(desc(amount)) 

md_payments |>
  filter(fiscal_year == 2023) |>
  arrange(desc(amount)) 

#looking at just the payments in fiscal 2023, sorted from highest to lowest, payments are repeated five times so they are counted five times, which is why the total money seems to be so high. The agency name, vendor name and amount are the exact same, and each is repeated the same amount so we believe this is a data entry error that made its way into the dataset.


payments_minus_2023_24 <- md_payments |>
  filter(!fiscal_year == 2023) |>
  filter(!fiscal_year == 2024) |>
  group_by(fiscal_year) |>
  summarise(total = sum(amount)) |>
  arrange(desc(total)) 

payments_minus_2023_24

#here, we filtered for every year except for 2023 which had the error in the data to then visualize how spending changed from year to year. We also took out fiscal 2024 because the fiscal year has not ended yet.

payments_minus_2023_24 |>
  ggplot() + 
  geom_line(aes(x=fiscal_year, y=total)) +
  labs(
    title = "Total Money Spent by State of Maryland per Fiscal Year",
    x = "Fiscal Year",
    y = "Total Amount",
    caption = "source: Maryland State Payments Data") 


  

# Fiscal 2023 saw the highest spending from the Maryland government with $193,756,398,403 paid.
# Fiscal 2022 was $36,656,748,838	



```

```{r}

md_payments_by_year <- md_payments |>
  filter(fiscal_year == "2023") |>
  summarise(total = sum(amount)) |>
  arrange(desc(total)) 

```

![]()

```{r}

census_api_key("62e3c67ce129c65ce2709f84982aa405a9811133", install=TRUE, overwrite = TRUE)
readRenviron("~/.Renviron")

md_pop_zip <- get_acs(geography = "zcta",
              variables = "B01003_001",
              state = "MD",
              year = 2019)  

md_payments

md_payments_2019 <- md_payments |>
  filter(fiscal_year == '2019') |>
  group_by(vendor_zip) |>
  summarize(total = sum(amount)) |>
  arrange(desc(total))

md_payments |>
  filter(vendor_zip == '21202') 
  
md_payments_2019 <- md_payments_2019 |>
  inner_join(md_pop_zip, by=c('vendor_zip' = 'GEOID'))
  
```

Which industries spent the most money?

```{r}

#Payments by industry

#Health
industry_data_health <- md_payments |>
  filter(str_detect(agency_name, "HEALTH")) |>
  group_by(fiscal_year) |>
  summarise(total_health = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "HEALTH")) |>
  count(agency_name)

#Education
industry_data_education <- md_payments |>
  filter(str_detect(agency_name, "EDUCATION") | str_detect(agency_name, "SCHOOL")) |>
  group_by(fiscal_year) |>
  summarise(total_education = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "EDUCATION") | str_detect(agency_name, "SCHOOL")) |>
  count(agency_name)

#Housing
industry_data_housing <- md_payments |>
  filter(str_detect(agency_name, "HOUSING")) |>
  group_by(fiscal_year) |>
  summarise(total_housing = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "HOUSING")) |>
  count(agency_name)

#Crime
industry_data_crime <- md_payments |>
  filter(str_detect(agency_name, "POLICE") | str_detect(agency_name, "CRIME") | str_detect(agency_name, "SAFETY")) |>
  group_by(fiscal_year) |>
  summarise(total_crime = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "POLICE") | str_detect(agency_name, "CRIME") | str_detect(agency_name, "SAFETY")) |>
  count(agency_name)

#Labor
industry_data_labor <- md_payments |>
  filter(str_detect(agency_name, "LABOR")) |>
  group_by(fiscal_year) |>
  summarise(total_labor = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "LABOR")) |>
  count(agency_name)

#Environment
industry_data_environment <- md_payments |>
  filter(str_detect(agency_name, "ENVIRONMENT") | str_detect(agency_name, "AGRICULTURE")) |>
  group_by(fiscal_year) |>
  summarise(total_environment = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "ENVIRONMENT") | str_detect(agency_name, "AGRICULTURE")) |>
  count(agency_name)

#Commerce
industry_data_commerce <- md_payments |>
  filter(str_detect(agency_name, "COMMERCE") | str_detect(agency_name, "COMPTROLLER")) |>
  group_by(fiscal_year) |>
  summarise(total_commerce = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "COMMERCE") | str_detect(agency_name, "COMPTROLLER")) |>
  count(agency_name)

#Transportation
industry_data_transportation <- md_payments |>
  filter(str_detect(agency_name, "HIGH") | str_detect(agency_name, "TRANS") | str_detect(agency_name, "MDOT")) |>
  group_by(fiscal_year) |>
  summarise(total_transportation = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "HIGH") | str_detect(agency_name, "TRANS") | str_detect(agency_name, "MDOT")) |>
  count(agency_name)

#combine them all
all_industry_data <- industry_data_commerce |>
    inner_join(industry_data_crime, by = 'fiscal_year') |>
    inner_join(industry_data_education, by = 'fiscal_year') |>
    inner_join(industry_data_environment, by = 'fiscal_year') |>
    inner_join(industry_data_health, by = 'fiscal_year') |>
    inner_join(industry_data_housing, by = 'fiscal_year') |>
    inner_join(industry_data_labor, by = 'fiscal_year') |>
    inner_join(industry_data_transportation, by = 'fiscal_year')

```

```{r}
industry_data_education <- md_payments |>
  filter(str_detect(agency_name, "EDUCATION") | str_detect(agency_name, "SCHOOL")) |>
  group_by(fiscal_year) |>
  summarise(total_education = sum(amount))

md_payments |>
  filter(str_detect(agency_name, "EDUCATION") | str_detect(agency_name, "SCHOOL")) |>
  count(agency_name)
```

Which zip codes receive the most money?

```{r}

```

Where are lower payments going compared to higher ones?

```{r}

```

What types of payments are going to education?

```{r}

```
